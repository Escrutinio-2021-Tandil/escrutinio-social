{% extends "adjuntos/asignar-mesa.html" %}
{% load i18n material_form material_frontend staticfiles %}

{% block js %}
{{ block.super }}

<style>
h5 {
    margin-bottom: 0.4rem !important;
    margin-top: 0.4rem !important;
}

.card-content {
    padding-top: 1rem !important;
    padding-left: 1em !important;
}
  
.collection {
    border: 0pt !important;
    padding-top: 0rem !important;
}

.collection-item {
    align-items: baseline;
    border: 0pt !important;
    display: flex;
    line-height: 1.4rem !important;
    vertical-align: bottom !important;
    padding : 0px 0px !important; 
}

.collection-item > dmc-select {
    flex: 1 75%;
}

.collection-item > div.row:last-child {
  flex: 1 25%;
}

.carga-acta-inline .input-field > input {
    margin: 0px;
    font-weight: 600;
    height: 1.4rem !important;
    vertical-align: bottom !important;
}

dmc-select select {
  border: 0;
  -webkit-appearance: none;
  -moz-appearance: none;
  height: 1.2rem !important;
  text-indent: 1px;
  text-overflow: '';
  padding: 0;
  padding-right: .8em;
  text-align-last: right;
}

.carga-acta-inline > dmc-select select::-ms-expand {
  display: none;
}

.card-content {
    background-color: {{ categoria.back_color }};
}

</style>

<script type="text/javascript">

$(document).ready(function(){
    $('ul.tabs').tabs();

    {% if not is_valid %}
    var hasError = $(".has-error");
    if (hasError.length) {
      $('html, body').animate({
          scrollTop: hasError.first().offset().top - 70
      }, 2000);

      // arreglar esta bosta!
      hasError.first().children('input').focus();
    }
    {% endif %}
    $('.modal').modal();

});
</script>
{% endblock js %}


{% block breadcrumbs_items %}
<a href="{{ object.get_absolute_url }}" class="active">{{ object.nombre_completo }}</a>
{% endblock %}


{% block page_title %}Cargar Acta {% endblock %}


{% block card-content %}
    <div class="card-title">
      <h5 style='background-color:{{ categoria.back_color }}; color: {{ categoria.color }}'><strong>{{ categoria }}</strong></h5>
    </div>
    {{ formset.management_form }}
    <div class="carga-acta-inline collection">
      {% for form in formset %}
      <div class="collection-item">
        {% form %}
        {% endform %}
      </div>
      {% endfor %}
    </div>
    {% if formset.non_form_errors %}
      <div style='color: red'>{{formset.non_form_errors}}</div>
      <div style='color: red'>¿Confirma que están cargados correctamente los valores que figuran en el acta?</div>
    {% endif %}
{% endblock card-content %}

{% block card-action %}
  {% if recibir_problema %}
    <div class="row">
        <div class="col s12">
            <div class="right-align">
                <button class="btn waves-effect waves-light btn white-text" type="submit" tabindex="30">
                    Guardar
                </button>
		            <a  class="waves-effect waves-light btn white-text modal-trigger red" href="#modal-problem" id="btn-problema">
                  Problema
		            </a>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col s12">
        </div>
    </div>
  {% endif %}
{% endblock card-action %}

{% block right-panel %}
    <script src="{% static 'js/fabric.js' %}"></script>
    <script src="{% static 'js/darkroom.js' %}"></script>

    <div class="acta card">

        <div class="card-content">

            <ul class="tabs">
              {% for title, foto in object.fotos %}
              <li class="tab col s3"><a {% if forloop.counter == 1 %}class="active"{% endif %} href="#foto{{ forloop.counter }}">{{ title }}</a></li>
              {% endfor %}
            </ul>
            {% for title, foto in object.fotos %}
                <div id="foto{{ forloop.counter }}" class="col s12 acta-container">
                    <img id="target{{ forloop.counter }}" src="{{ foto.thumbnail.960x.url }}">
                    <script>
                    new Darkroom('#target{{ forloop.counter }}', {
                      plugins: {
                        save: false,
                        crop: false
                      }
                    });
                    </script>
                </div>
            {% endfor %}

        </div>

    </div>
{% endblock right-panel %}
