{% extends "adjuntos/asignar-mesa.html" %}
{% load i18n material_form material_frontend staticfiles %}

{% block js %}
{{ block.super }}

<style>

.card-content {
    background-color: {{ categoria.back_color }};
}

</style>

<script type="text/javascript">

$(document).ready(function(){
    $('ul.tabs').tabs();

    {% if not is_valid %}
    var hasError = $(".has-error");
    if (hasError.length) {
      $('html, body').animate({
          scrollTop: hasError.first().offset().top - 70
      }, 2000);

      // arreglar esta bosta!
      hasError.first().children('input').focus();
    }
    {% endif %}
    $('.modal').modal();

});
</script>
{% endblock js %}


  {% block extra_form %}
  {% endblock extra_form %}


{% block breadcrumbs_items %}
<a href="{{ object.get_absolute_url }}">{{ object }}</a>
<a class="active">Acta</a>
{% endblock %}


{% block page_title %}Cargar Acta {% endblock %}


{% block card-content %}
    <div class="card-title"> Mesa {{ object.numero }}
        <b style='background-color: {{ categoria.back_color }}; color: {{ categoria.color }}'>{{ categoria }}</b>
    </div>
    <form method="POST">
    {{ formset.management_form }}
    {% for form in formset %}
        {% form %}{% endform %}
    {% endfor %}
    </form>
{% endblock card-content %}

{% block card-action %}

        <div class="row">

            <div class="col s12">
                <div class="right-align">
                    <button class="btn waves-effect waves-light btn white-text" type="submit" tabindex="30">
                      Guardar
                    </button>
		    <a  class="waves-effect waves-light btn white-text modal-trigger red" href="#modal-problem" id="btn-problema">
                      Problema
		    </a>
                </div>
            </div>

        </div>

        <div class="row">
            <div class="col s12">
            </div>
        </div>


    </div>

{% include "problemas/problema.html" %}

{% endblock card-action %}

{% block right-panel %}
    <script src="{% static 'js/fabric.js' %}"></script>
    <script src="{% static 'js/darkroom.js' %}"></script>

    <div class="acta card">

        <div class="card-content">

            <ul class="tabs">
              {% for title, foto in object.fotos %}
              <li class="tab col s3"><a {% if forloop.counter == 1 %}class="active"{% endif %} href="#foto{{ forloop.counter }}">{{ title }}</a></li>
              {% endfor %}
            </ul>
            {% for title, foto in object.fotos %}
                <div id="foto{{ forloop.counter }}" class="col s12 acta-container">
                    <img id="target{{ forloop.counter }}" src="{{ foto.thumbnail.960x.url }}">
                    <script>
                    new Darkroom('#target{{ forloop.counter }}', {
                      plugins: {
                        save: false,
                        crop: false
                      }
                    });
                    </script>
                </div>
            {% endfor %}

        </div>

    </div>
{% endblock right-panel %}
