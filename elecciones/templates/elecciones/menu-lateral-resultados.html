{% extends "fiscales/base.html" %}
{% load staticfiles %}

{% block title %}Resultados{% endblock %}

{% block js %}
{{ block.super }}

{% endblock %}

 {% block head %}
    {{ block.super }}
    <link href="{% static 'elecciones/resultados.css' %}" rel="stylesheet" type="text/css">
    <!-- 4 include the jQuery library -->
    <!-- XXX creo que ya está jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
    <!-- 5 include the minified jstree source -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
    <!-- <link rel="stylesheet" href="http://www.orangehilldev.com/jstree-bootstrap-theme/demo/assets/dist/themes/proton/style.css" /> -->
 {% endblock %}

{% block sidenav_items %}
<!-- <li>{{request.GET.distrito}}</li> -->
<li><input id="search-input" class="search-input"/></li>
<li style="overflow: auto; height: 70%;"><div id="jstree"></div></li>
<script>
  // Construyo el árbol.
  cat_id = {{ cat_id }}
  url_base = 'http://localhost:8000/elecciones/resultados-cuerpo-central/{{ cat_id }}'
  // Los distritos.
  arbol_distritos = []
  {% for distrito in distritos %}
    // Las secciones.
    arbol_secciones = []
    {% for seccion in distrito.secciones.all %}
      // Los circuitos.
      arbol_circuitos = []
      {% for circuito in seccion.circuitos.all %}
        url = url_base + '?circuito=' + {{ circuito.id }}
        arbol_circuitos.push({'text': '{{ circuito.nombre }}', 'a_attr': {'href': url}, 'children': []})
      {% endfor %}
      url = url_base + '?seccion=' + {{ seccion.id }}
      arbol_secciones.push({'text': '{{ seccion.nombre }}', 'a_attr': {'href': url}, 'children': arbol_circuitos})

    {% endfor %}

    url = url_base + '?distrito=' + {{ distrito.id }}
    arbol_distritos.push({'text': '{{ distrito.nombre }}', 'a_attr': {'href': url}, 'children': arbol_secciones})
  {% endfor %}
  arbol_pais = {'text': 'Todo el país', 'a_attr': {'href': url_base}, 'children': arbol_distritos, 'state': {'opened': true}}

  $(function () {
  $('#jstree').jstree({
    'core': {
      'data': arbol_pais,
      // 'themes': {
      //   'name': 'proton',
      //   'responsive': true
      // },
      // 'plugins': [ 'search' ]
    }
  })

  $(document).on('click', '.jstree-anchor', function(e) {
    var href_address = e.currentTarget.attributes.href;
    $.ajax({
      url: href_address.value,
      success: function(r) {
        document.getElementById('resultados').innerHTML=r
      },
      error: function(r) {
        console.log('ERROR', r)
      }
    });
    return false;
  });
});

</script>
{% endblock %}


{% block content %}
<div class="row" style="width:100%">
  <div id="resultados" class="col s12"></div>
</div>
{% endblock content %}
